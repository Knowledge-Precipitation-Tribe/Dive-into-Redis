# 通信流程

在分布式存储中需要提供维护节点元数据信息的机制，所谓元数据是 指：节点负责哪些数据，是否出现故障等状态信息。常见的元数据维护方式 分为：集中式和P2P方式。Redis集群采用P2P的Gossip（流言）协议， Gossip协议工作原理就是节点彼此不断通信交换信息，一段时间后所有的节 点都会知道集群完整的信息，这种方式类似流言传播，如图所示。

![](../../.gitbook/assets/image%20%28171%29.png)

通信过程说明：

1）集群中的每个节点都会单独开辟一个TCP通道，用于节点之间彼此 通信，通信端口号在基础端口上加10000。

2）每个节点在固定周期内通过特定规则选择几个节点发送ping消息。

3）接收到ping消息的节点用pong消息作为响应。

集群中每个节点通过一定规则挑选要通信的节点，每个节点可能知道全 部节点，也可能仅知道部分节点，只要这些节点彼此可以正常通信，最终它 们会达到一致的状态。当节点出故障、新节点加入、主从角色变化、槽信息 变更等事件发生时，通过不断的ping/pong消息通信，经过一段时间后所有的 节点都会知道整个集群全部节点的最新状态，从而达到集群状态同步的目的。

