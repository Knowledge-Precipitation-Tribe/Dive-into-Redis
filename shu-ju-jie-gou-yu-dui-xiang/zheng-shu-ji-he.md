# 整数集合

整数集合是集合键的底层实现之一，当一个集合只包含整数值元素，并且这个集合的元素数量不多时，Redis就会使用整数集合作为集合键的底层实现。

## 整数集合的实现

整数集合是Redis用于保存整数值的集合抽象数据结构，它可以保存类型为int16\_t,int32_\__t,int64\_t的整数值，并且可以保证集合中不会出现重复的元素。

![](../.gitbook/assets/image%20%28252%29.png)

contents数组是整数集合的底层实现：整数集合的每个元素都是contents数组的一个数组项，各个项在数组中按照值的大小从小到大有序的排列，并且数组中不包含任何重复项。legth属性记录了整数集合包含的元素数量，即contents数组的长度。

![](../.gitbook/assets/image%20%28253%29.png)

## 升级

每当我们要将一个新元素添加到整数集合里面，并且新元素的类型比整数集合现有所有元素的类型都要长时，整数集合需要先进行升级，然后才能将新元素添加到整数集合里面。

升级整数集合并添加新的元素一共分为三部分：

* 根据新元素的类型，拓展整数集合底层数组的空间大小，并为新元素分配空间。
* 将底层数组现存的所有元素都转换成与新元素相同的类型，并将类型转化后的元素放置到正确的位上，而且在放置元素的过程中，需要继续维持底层数组的有序性质不变。
* 将新元素添加到底层数组里面。

### 升级好处

* **提升灵活性**：C语言是静态语言，一般不会将不同类型的元素放到相同的数据结构中，因为整数集合底层会自动实现升级，所以十分灵活。
* **节约内存**：如果一个数组要保存三种类型的值，用最大的那个类型肯定是没有问题的，但是通过自动升级，使得存小数据的时候只用小的数据类型就可以了。

## 降级（不支持）

整数集合不支持降级操作，一旦对数组进行了升级，编码就会一直保持升级后的状态。

